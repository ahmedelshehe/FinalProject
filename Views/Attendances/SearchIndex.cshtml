@model X.PagedList.StaticPagedList<EmployeeAttendanceVM>
@using FinalProject.Utilities
@using X.PagedList;
@using X.PagedList.Mvc.Core;
@using X.PagedList.Mvc.Core.Fluent
@using X.PagedList.Web.Common;
﻿@{
    var pagedList = (IPagedList)Model;
}
@{
    ViewData["Title"] = "Index";
    var permissions = Context.Items["Permissions"] as List<Permission>;
    var canShowAttendance = permissions.HasPermission("Attendance", Operation.Show); ;
    var canAddAttendance = permissions.HasPermission("Attendance", Operation.Add); ;
    var canUpdateAttendance = permissions.HasPermission("Attendance", Operation.Update); ;
    var canDeleteAttendance = permissions.HasPermission("Attendance", Operation.Delete); ;
    bool havePermissions = permissions == null ? false : true;
}
<div class="row align-items-center welcome-box align-content-between m-2">
    <div class="col-5">
        <h3>Search Attendance</h3>

    </div>
    <div class="col">
        <div class="text-center">
            <form asp-action="SearchIndex" method="post" enctype="multipart/form-data" class="form-inline">
                <input type="text" class="form-control m-2" name="searchName" placeholder="Search By Employee Name or Department" />
                <label class="control-label">To</label>
                <input type="date" name="to" class="form-control m-2" />
                <label class="control-label">From</label>
                <input type="date" name="from" class="form-control m-2" />
                <input class="btn btn-outline-secondary" type="submit" value="Search" />
                <div @(canAddAttendance) class="row p-2 m-2">
                    <a asp-action="Create" class="col"><i class="fa-sharp fa-solid fa-plus fa-2xl"></i></a>
                    <a asp-action="UploadFile" class="col">
                        <i class="fa-regular fa-file-excel fa-2xl" style="color: #135007;"></i>
                    </a>
                </div>
                    
            </form>
        </div>
    </div>
</div>

<div class="row align-items-start align-content-between m-4">
    <div class="card p-3 shadow col-10 ml-5" id="attendance-index-print">
        <div class="welcome-det print-on">
            <h3>Attendance Report</h3>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>
                        Employee
                    </th>
                    <th>
                        Arrival Time
                    </th>
                    <th>
                        Departure Time
                    </th>
                    <th>
                        Date
                    </th>

                    <th colspan="3" class="print-off">
                        Actions
                    </th>

                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.FirstName  ) @Html.DisplayFor(modelItem => item.LastName  )
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ArrivalTime)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.DepartureTime)
                        </td>
                        <td>
                            @item.Date.ToString("dd MMM yyy")
                        </td>

                        <td class="print-off" @(canUpdateAttendance)>
                            <a asp-action="Edit" asp-route-id="@item.EmployeeId" asp-route-date="@item.Date">
                                <i class="fa-solid fa-pen-to-square fa-lg" style="color: #000000;"></i>
                            </a>
                        </td>
                        <td class="print-off" @(canShowAttendance)>
                            <a asp-action="Details" asp-route-id="@item.EmployeeId" asp-route-date="@item.Date"><i class="fa-solid fa-circle-info fa-l" style="color: #000000;"></i></a>
                        </td>
                        <td class="print-off" @(canDeleteAttendance)>
                            <a asp-action="Delete" asp-route-id="@item.EmployeeId" asp-route-date="@item.Date"><i class="fa-solid fa-trash fa-l" style="color: #000000;"></i></a>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="col">
        <a onclick="printContent('attendance-index-print')" style="cursor:pointer;"><i class="fa-solid fa-print fa-2xl" style="color: #00276b;"></i></a>
    </div>
</div>
<div id="container" style="margin-left: 20px">
    <div class="pagination" style="margin-left: 400px">
        @Html.PagedListPager(pagedList, page => Url.Action("SearchIndex", new {searchName = ViewBag.EmployeeName,to =ViewBag.to ,from=ViewBag.from, page }), new PagedListRenderOptions
        {
        DisplayLinkToIndividualPages = true,
        DisplayPageCountAndCurrentLocation = false,
        MaximumPageNumbersToDisplay = 10,
        UlElementClasses =new string[] {"pagination justify-content-end"},
        LiElementClasses = new string[] { "page-item" },
        PageClasses = new string[] { "page-link" },

        })
    </div>
</div>